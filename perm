mkdir -p /var/log/abuseipdbchecker
chmod -R 777 /var/log/abuseipdbchecker
chown -R www:www /var/log/abuseipdbchecker

mkdir -p /var/db/abuseipdbchecker
chmod -R 777 /var/db/abuseipdbchecker
chown -R www:www /var/db/abuseipdbchecker

mkdir -p /usr/local/etc/abuseipdbchecker
chmod -R 755 /usr/local/etc/abuseipdbchecker

chmod 755 /usr/local/opnsense/scripts/AbuseIPDBChecker/checker.py
chmod 755 /usr/local/opnsense/scripts/AbuseIPDBChecker/setup_database.py

echo "[$(date '+%Y-%m-%d %H:%M:%S')] Manual test log entry created" >> /var/log/abuseipdbchecker/abuseipdb.log
chmod 666 /var/log/abuseipdbchecker/abuseipdb.log

mkdir -p /usr/local/opnsense/scripts/OPNsense
ln -sf /usr/local/opnsense/scripts/AbuseIPDBChecker /usr/local/opnsense/scripts/OPNsense/

service configd restart

echo "Testing checker.py logs command:"
/usr/local/opnsense/scripts/AbuseIPDBChecker/checker.py logs

echo "Testing configd command:"
configctl abuseipdbchecker logs

echo "If you see a JSON response above, the script is working correctly."
echo "If not, check for errors in the script output or PHP error log."